<section>
	<header>
		<span class="brand">ðŸ”¥ sizzle.link</span>
	</header>

	<form method="post">
		<label>
			<span>Link ID</span>
			<input name="code" required autocomplete="off" />
		</label>
		<div class="actions">
			<button name="do" value="get-secret">Get secret</button>
		</div>
	</form>

	<form method="post">
		<label>
			<span>Secret</span>
			<textarea name="secret" placeholder="Type or paste your secret" required></textarea>
		</label>
		<label>
			<span>Password (required)</span>
			<input name="password" type="password" autocomplete="new-password" minlength="8" placeholder="Enter password to encrypt" required />
		</label>
		<div class="actions">
			<button name="do" value="create-link">Create link</button>
		</div>
	</form>

	<p>Creates a one-time-use secret link. Secret automatically burns after opening.</p>
</section>

<dialog class="output" id="link" data-element data-bind:data-code="code">
	<form>
		<div class="label-with-button">
			<label>
				<span>Sharable link</span>
				<input name="link" readonly data-bind:value="link" />
			</label>

			<button class="copy">Copy</button>
		</div>

		<div class="actions center">
			<button class="close">Close</button>
		</div>

		<p class="info"><small>Oneâ€‘time secret link. Burns on first open. Recipients can still copy text.</small></p>
	</form>
	<script>
		const dialog = document.currentScript.parentElement;
		const linkInput = dialog.querySelector("[name='link']");
		const copyButton = dialog.querySelector("button.copy");

		dialog.showModal();
		linkInput.select();
		copyButton.addEventListener("click", e => {
			e.preventDefault();
			navigator.clipboard.writeText(linkInput.value);
			copyButton.classList.add("copied");
			setTimeout(() => {
				copyButton.classList.remove("copied");
			}, 1000);
		});
		dialog.querySelector("button.close").addEventListener("click", e => {
			e.preventDefault();
			window.location.href = "/";
		});
	</script>
</dialog>
